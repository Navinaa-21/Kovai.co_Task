import pandas as pd
from prophet import Prophet
import matplotlib.pyplot as plt

df = pd.read_csv('/content/Daily_Public_Transport_Passenger_Journeys_by_Service_Type_20250526.csv')

df['Date'] = pd.to_datetime(df['Date'], dayfirst=True)

forecast_columns = ['Local Route', 'Light Rail', 'Peak Service', 'Rapid Route', 'School', 'Other']

for column in forecast_columns:
    print(f"\n--- Forecasting: {column} ---\n")

    data = df[['Date', column]].rename(columns={'Date': 'ds', column: 'y'})

    data = data.dropna()
    data['y'] = pd.to_numeric(data['y'], errors='coerce')
    data = data.dropna()

    model = Prophet()
    model.fit(data)

    future = model.make_future_dataframe(periods=7)

    forecast = model.predict(future)

    fig = model.plot(forecast)
    plt.title(f"{column} - Forecast for Next 7 Days")
    plt.xlabel("Date")
    plt.ylabel(column)
    plt.grid(True)
    plt.show()

    forecast_result = forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail(7)
    print(forecast_result)

    forecast_result.to_csv(f"{column.replace(' ', '_')}_forecast.csv", index=False)


    # Display forecasted values (next 7 days)
    forecast_result = forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail(7)
    print(forecast_result)

    # Optional: Save forecast to CSV
    forecast_result.to_csv(f"{column.replace(' ', '_')}_forecast.csv", index=False)
